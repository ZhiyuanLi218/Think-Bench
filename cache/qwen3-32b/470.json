{"question":"A soccer team has $22$ available players. A fixed set of $11$ players starts the game, while the other $11$ are available as substitutes. During the game, the coach may make as many as $3$ substitutions, where any one of the $11$ players in the game is replaced by one of the substitutes. No player removed from the game may reenter the game, although a substitute entering the game may be replaced later. No two substitutions can happen at the same time. The players involved and the order of the substitutions matter. Let $n$ be the number of ways the coach can make substitutions during the game (including the possibility of making no substitutions). Find the remainder when $n$ is divided by $1000$ .","answer":"122","index":470,"key_annotation_steps":{"solution1":{"logical_conclusion":["step1: We need to count all possible ways the coach can make substitutions, including making no substitutions.","step2: When making no substitutions, there is exactly 1 way to do this.","step3: For 1 substitution, we select 1 player from the 11 starters to remove and 1 player from the 11 substitutes to enter, giving 11 × 11 = 121 ways.","step4: For 2 substitutions, we consider two cases: Case 1: Both substitutions involve original starters. Case 2: The second substitution involves a substitute who entered earlier.","step5: For Case 1 of 2 substitutions, we select 2 starters to remove (in order) and 2 substitutes to enter (in order), giving 11×10 × 11×10 = 12,100 ways.","step6: For Case 2 of 2 substitutions, we select 1 starter to remove, 1 substitute to enter, then replace that substitute with another substitute, giving 11 × 11 × 1 × 10 = 1,210 ways.","step7: Total for 2 substitutions is 12,100 + 1,210 = 13,310 ways.","step8: For 3 substitutions, we consider multiple cases based on which players are substituted out (starters or previously entered substitutes).","step9: The calculation for 3 substitutions involves summing all possible ordered sequences of substitutions, accounting for dynamic changes in available players, resulting in 994,690 ways.","step10: The total number of ways n = 1 (no subs) + 121 (1 sub) + 13,310 (2 subs) + 994,690 (3 subs) = 1,008,122.","step11: The remainder when 1,008,122 is divided by 1000 is 122."]}},"question_type":"Hard","category":"math","subcategory":"combinatorics","prediction":"To solve the problem, we are tasked with computing the number of ways a soccer coach can make **up to 3 substitutions**, including the option of making **no substitutions**, under the following rules:\n\n- The game starts with 11 players on the field and 11 substitutes on the bench.\n- A substitution consists of removing one of the 11 players on the field and replacing them with one of the substitutes who has **not** been used yet.\n- Once a player is removed from the game, they **cannot** return.\n- The **order** of substitutions matters.\n- The coach can make **0, 1, 2, or 3** substitutions.\n\n---\n\n### Step 1: Model the Problem\n\nLet’s define the total number of possible substitution sequences for exactly $ k $ substitutions as:\n\n$$\nS_k = 11^k \\cdot P(11, k)\n$$\n\nWhere:\n\n- $ 11^k $: At each substitution, the coach has 11 choices of which player to substitute **out** (since the team always has 11 players on the field).\n- $ P(11, k) = 11 \\cdot 10 \\cdot \\dots \\cdot (11 - k + 1) $: The number of ways to choose **k distinct substitutes** from the 11 available ones, in **order**.\n\nThe total number of ways the coach can make **up to 3 substitutions** is:\n\n$$\nn = \\sum_{k=0}^{3} S_k = 1 + 11^1 \\cdot P(11,1) + 11^2 \\cdot P(11,2) + 11^3 \\cdot P(11,3)\n$$\n\n---\n\n### Step 2: Compute Each Term\n\n- **For $ k = 0 $:**  \n  $$\n  S_0 = 1\n  $$\n\n- **For $ k = 1 $:**  \n  $$\n  S_1 = 11^1 \\cdot P(11,1) = 11 \\cdot 11 = 121\n  $$\n\n- **For $ k = 2 $:**  \n  $$\n  S_2 = 11^2 \\cdot P(11,2) = 121 \\cdot (11 \\cdot 10) = 121 \\cdot 110 = 13,310\n  $$\n\n- **For $ k = 3 $:**  \n  $$\n  S_3 = 11^3 \\cdot P(11,3) = 1331 \\cdot (11 \\cdot 10 \\cdot 9) = 1331 \\cdot 990 = 1,317,690\n  $$\n\n---\n\n### Step 3: Add All Values\n\n$$\nn = 1 + 121 + 13,310 + 1,317,690 = 1,331,122\n$$\n\n---\n\n### Step 4: Compute $ n \\mod 1000 $\n\nTo find the remainder when $ n $ is divided by 1000, we only need the last three digits of $ n $:\n\n$$\nn \\mod 1000 = 122\n$$\n\n---\n\n### Final Answer\n\n$$\n\\boxed{122}\n$$","think_content":"<think>\nOkay, so I need to figure out the number of ways a soccer coach can make substitutions during a game, given certain constraints, and then find that number modulo 1000. Let me start by understanding the problem step by step.\n\nFirst, there are 22 players on the team. 11 start the game, and 11 are substitutes. The coach can make up to 3 substitutions. Each substitution involves taking one of the 11 starting players out and replacing them with one of the substitutes. Once a player is substituted out, they can't come back in. Also, substitutions happen one after another, not at the same time, so the order matters. Also, the problem says that the players involved and the order of substitutions matter. So, I need to account for both who is substituted and when they are substituted.\n\nThe question asks for the total number of ways the coach can make substitutions during the game, including the possibility of making no substitutions. Then, take that number modulo 1000.\n\nLet me break this down. First, consider the case where the coach makes no substitutions. There's obviously 1 way for that.\n\nNext, if the coach makes 1 substitution. How many ways can that happen? Well, for each substitution, you need to choose one of the 11 starting players to take out and one of the 11 substitutes to put in. So, that would be 11 * 11 = 121 possibilities. Since there's only one substitution, order doesn't matter here? Wait, but the problem says the order of substitutions matters. However, since there's only one substitution, there's only one order. So, yeah, 121 ways for one substitution.\n\nNow, for two substitutions. Here, the order matters. So, substitutions are done in sequence. Also, once a player is substituted out, they can't come back. However, substitutes who come in can be substituted later. So, for the first substitution, we have 11 starting players and 11 substitutes. But after the first substitution, there are now 10 original starting players and 1 substitute on the field. The substitutes bench now has 10 substitutes left, since one has been used. Wait, actually, when you make a substitution, you take out a player from the field (starting or previously substituted in?) and put in a substitute. Wait, the problem says \"any one of the 11 players in the game is replaced by one of the substitutes.\" So, regardless of whether a player on the field is original or a substitute who came in, you can substitute them. But once a player is removed, they can't reenter. So, substitutes who are brought into the game can later be substituted out, but the original players who are substituted out cannot come back.\n\nTherefore, for each substitution, the number of available substitutes decreases by one each time a substitution is made, because once a substitute is brought in, they are now on the field, and substitutes on the field can be substituted out later, but the substitutes who are on the bench decrease as you use them.\n\nWait, let me clarify:\n\nInitially, on the field: 11 original players.\n\nOn the bench: 11 substitutes.\n\nEach substitution involves taking someone out of the field (any of the 11 currently on the field) and putting in someone from the bench (any of the substitutes who haven't been used yet? Or substitutes who are on the bench? Wait, the problem says \"one of the substitutes\". Since substitutes who have entered the game are now on the field, so they can't be substituted again from the bench. Wait, no: when you make a substitution, you take someone out and put a substitute in. The substitutes are the original 11 who started on the bench. Once a substitute is put into the game, they are now on the field. If they are substituted out later, they can't come back. But the substitutes that are still on the bench haven't been used yet. Therefore, each substitution uses one new substitute from the bench. Therefore, the number of available substitutes decreases by one each time.\n\nTherefore, for the first substitution, there are 11 choices for the player to take out, and 11 substitutes to put in.\n\nFor the second substitution, there are still 11 players on the field (since one was taken out and one was put in). However, one substitute has already been used, so there are 10 substitutes left on the bench. Therefore, for the second substitution, there are 11 choices for the player to take out, and 10 substitutes to put in.\n\nSimilarly, for the third substitution, if it happens, there would be 11 choices for the player to take out and 9 substitutes to put in.\n\nBut since substitutions are ordered, making substitution A then substitution B is different from substitution B then substitution A, even if they involve different players. Therefore, for two substitutions, the total number is 11*11 (for first substitution) multiplied by 11*10 (for the second substitution). Wait, but hold on, no. Wait, for each substitution, the number of possibilities depends on the previous substitutions.\n\nWait, actually, when you do the first substitution, you have 11 players on the field and 11 substitutes on the bench.\n\nAfter the first substitution, the number of players on the field is still 11, but one of them is a substitute. The number of substitutes remaining on the bench is 10.\n\nSo, for the second substitution, regardless of who you take out (any of the 11 on the field), and you put in one of the remaining 10 substitutes.\n\nTherefore, the number of possibilities for the second substitution is 11 * 10.\n\nSimilarly, for the third substitution, it would be 11 * 9.\n\nTherefore, the number of ways to make k substitutions is (11 * 11) * (11 * 10) * ... ?\n\nWait, no. Wait, if substitutions are ordered, then for k substitutions, it's the product for each substitution step.\n\nSo for k substitutions, the number of ways is:\n\nFirst substitution: 11 (players out) * 11 (substitutes in)\n\nSecond substitution: 11 (players out) * 10 (remaining substitutes in)\n\nThird substitution: 11 (players out) * 9 (remaining substitutes in)\n\nTherefore, for k substitutions, it's (11 * 11) * (11 * 10) * ... up to k terms?\n\nWait, no. Wait, for k substitutions, the number of sequences would be:\n\nProduct from i=0 to i=k-1 of (11 * (11 - i)) ?\n\nWait, for each substitution, you have 11 choices for the player to substitute out (since there are always 11 on the field), and for substitutes, you have 11 substitutes for the first substitution, then 11 - 1 for the second, etc. Therefore, for k substitutions, the number of ways is 11^k * P(11, k), where P(n, k) is the permutation of n things taken k at a time.\n\nWait, P(11, k) is 11 * 10 * 9 * ... * (11 - k + 1). Therefore, the total number of substitution sequences for exactly k substitutions is 11^k multiplied by P(11, k). Wait, let me check:\n\nFor k=1: 11^1 * P(11, 1) = 11 * 11 = 121, which matches.\n\nFor k=2: 11^2 * P(11, 2) = 11^2 * 11*10. Wait, but hold on, that would be 11^2 * 11*10? Wait, no, that seems too big. Wait, no, maybe I have an error here.\n\nWait, no. Wait, for each substitution, there are two choices: who to take out and who to put in. For each substitution, taking out is 11 choices, putting in is (11 - number of previous substitutions) choices. Therefore, for the first substitution: 11 * 11. For the second substitution: 11 * 10. For the third substitution: 11 * 9. Therefore, for k substitutions, the total number of sequences is 11^k multiplied by 11 * 10 * 9 * ... * (11 - k + 1). Wait, no:\n\nWait, actually, for k substitutions, the total number is the product over each substitution step. For substitution 1: 11 * 11. For substitution 2: 11 * 10. For substitution 3: 11 * 9. Therefore, total for k substitutions is 11^k multiplied by 11 * 10 * 9 * ... * (11 - k + 1) divided by 11^{k-1} }? Wait, no. Wait:\n\nWait, for substitution 1: 11 (players out) * 11 (substitutes in)\n\nSubstitution 2: 11 (players out) * 10 (remaining substitutes)\n\nSubstitution 3: 11 (players out) * 9 (remaining substitutes)\n\nTherefore, total number for k substitutions is 11^k multiplied by 11 * 10 * 9 * ... * (11 - k + 1) divided by ... Wait, no. Wait, for k substitutions, the total is:\n\n(11 * 11) * (11 * 10) * (11 * 9) * ... * (11 * (11 - k + 1)) ?\n\nWait, but that would be 11^k multiplied by P(11, k). Wait, yes:\n\nFor k substitutions, the number is 11^k * 11 * 10 * ... * (11 - k + 1). Wait, but that seems like 11^{k} * P(11, k). Wait, but for k=1, that would be 11^1 * 11 = 121, which is correct. For k=2, 11^2 * 11 * 10? Wait, but that would be 11^2 * 11 * 10? Wait, but that would be 11^3 * 10? Wait, no, that can't be. Wait, no. Wait, if you have two substitutions, the total is (11 * 11) * (11 * 10) = 11^2 * 11 * 10? No, that's 11^2 * 11 * 10? No, (11 * 11) * (11 * 10) is 11^3 * 10. But that seems like more than necessary. Wait, but let me think.\n\nWait, substitution 1: 11 choices for who to take out, 11 substitutes to put in.\n\nSubstitution 2: 11 choices for who to take out (since there are still 11 players on the field, one has been replaced by a substitute, but you can take out any of them), and 10 substitutes left on the bench.\n\nTherefore, substitution 2 has 11 * 10 possibilities. Therefore, total for two substitutions is 11*11 * 11*10 = 11^2 * 11 * 10? Wait, no, 11*11 multiplied by 11*10? That would be 11^3 * 10? Wait, 11*11 is 121, multiplied by 11*10 is 110, so total is 121*110 = 13310. Alternatively, if I think of it as (11 * 11) * (11 * 10) = 11^2 * 11 * 10? Wait, no, that would be 11^3 * 10? Wait, no, 11 * 11 * 11 * 10 = 11^3 * 10. But 11^3 is 1331, times 10 is 13310. So yes, that's correct.\n\nBut how does that relate to permutations? Let me think. The number of ways to choose substitutes is permutations of substitutes: for k substitutions, we need to choose an ordered list of k substitutes (since each substitution uses a new substitute, and order matters because substitutions are ordered). The number of ways to choose substitutes is P(11, k) = 11 * 10 * ... * (11 - k + 1). Then, for each substitution, we also have to choose which player to take out. Since at each substitution, there are 11 choices. Since substitutions are ordered, and for each substitution, independent of the others, we have 11 choices for the player to take out. Therefore, for k substitutions, the number of ways to choose the players to take out is 11^k. Therefore, total number of substitution sequences for exactly k substitutions is 11^k * P(11, k). Therefore, for k substitutions:\n\nNumber of ways = 11^k * P(11, k).\n\nTherefore, for k=0: 1 way.\n\nFor k=1: 11^1 * P(11, 1) = 11 * 11 = 121.\n\nFor k=2: 11^2 * P(11, 2) = 121 * 11 * 10 = 121 * 110 = 13,310.\n\nWait, but earlier calculation gave us 11*11 * 11*10 = same thing. So yes, that works.\n\nSimilarly, for k=3: 11^3 * P(11, 3) = 11^3 * 11 * 10 * 9 = Wait, no:\n\nWait, P(11, 3) is 11 * 10 * 9, so 11^k * P(11, k) for k=3 is 11^3 * 11 * 10 * 9? Wait, no:\n\nWait, no. Wait, 11^k is 11^3, and P(11, k) is P(11, 3) = 11*10*9. Therefore, total is 11^3 * 11 * 10 * 9? Wait, no, that would be 11^4 * 10 * 9. Wait, no. Wait, no:\n\nWait, no, the formula is 11^k multiplied by P(11, k). For k=3, that would be 11^3 * 11 * 10 * 9? No, no, P(11, 3) is 11*10*9. So the total is 11^3 * 11*10*9? No, that would be 11^3 * P(11, 3). Wait, but 11^3 * P(11, 3) is 11^3 * 11 * 10 * 9? No, P(11, 3) is 11*10*9. So total is 11^3 * 11*10*9? No, that would be multiplying 11^3 by P(11, 3). But that would be 11^3 * 11*10*9? Wait, no. Wait, no, the formula is 11^k multiplied by P(11, k). So for k=3, it's 11^3 multiplied by P(11, 3). Which is 11^3 * 11*10*9? No, P(11, 3) is 11*10*9. So total is 11^3 * 11*10*9? No, that would be 11^3 * P(11, 3). Wait, no, 11^k is 11^3, and P(11, k) is 11*10*9. Therefore, total is 11^3 * 11 * 10 * 9? No, that would be 11^4 * 10 * 9. Wait, no. Wait, no, 11^3 * P(11, 3) is 11^3 * (11 * 10 * 9). Wait, but that would be 11^3 * 11 * 10 * 9? Which is 11^4 * 10 * 9? Wait, no, 11^3 * 11 is 11^4. So yes. But that seems like a lot. But let me check with substitution logic.\n\nFor three substitutions:\n\nFirst substitution: 11 * 11\n\nSecond substitution: 11 * 10\n\nThird substitution: 11 * 9\n\nTherefore, total is 11*11 * 11*10 * 11*9? No, that would be (11*11)*(11*10)*(11*9). Wait, but that would be 11^3 * 11^3 * 11*10*9? No, no. Wait, no, each substitution is multiplied. So first substitution: 11*11. Second substitution: multiply by 11*10. Third substitution: multiply by 11*9. Therefore, total is (11*11) * (11*10) * (11*9) = 11^3 * 11 * 10 * 9? Wait, no:\n\nWait, 11*11 is 11^2. Multiply by 11*10 gives 11^3 * 10. Multiply by 11*9 gives 11^4 * 9 * 10. Wait, that seems inconsistent with the formula I had earlier. Wait, so which is correct?\n\nWait, if I think of it as for each substitution, there's a choice of player to take out (11 choices) and a substitute to put in (for first substitution, 11; second substitution, 10; third substitution, 9). Therefore, the total number of sequences for three substitutions is:\n\n(11 * 11) * (11 * 10) * (11 * 9) ?\n\nBut that would be 11^3 * 11 * 10 * 9? Wait, no:\n\nWait, (11 * 11) is first substitution. Then multiply by (11 * 10) for the second substitution. Multiply by (11 * 9) for the third substitution. So total is 11 * 11 * 11 * 10 * 11 * 9? Wait, no:\n\nWait, no, the first substitution is 11 (players) * 11 (substitutes). Then the second substitution is another 11 (players) * 10 (remaining substitutes). Third substitution is another 11 (players) * 9 (remaining substitutes). Therefore, total is (11 * 11) * (11 * 10) * (11 * 9) = 11^3 * 11 * 10 * 9? Wait, no, 11^3 is 11*11*11, and then multiplied by 11*10*9? That would be 11^4 * 10 * 9. But that seems way too big.\n\nBut if I use the formula I thought of before, 11^k * P(11, k). For k=3, that would be 11^3 * P(11, 3) = 11^3 * 11*10*9? Which is the same as above. But that seems way too big. Let me check with numbers.\n\nLet me take k=2. According to substitution logic: 11*11 * 11*10 = 11^2 * 11 * 10 = 11^3 * 10. Which is 1331 * 10 = 13310. According to the formula 11^k * P(11, k), where k=2: 11^2 * P(11, 2) = 121 * 110 = 13310. Same result. So that works. For k=3, it would be 11^3 * P(11, 3) = 1331 * 990. Which is 1331 * 990. That seems correct? Let me check with substitution steps: (11*11)*(11*10)*(11*9) = 11^5 * 10 * 9? Wait, no:\n\nWait, (11*11)*(11*10)*(11*9) is 11*11*11*10*11*9? No, no. Wait, no, there are three substitutions. Each substitution contributes a 11 (players) and a substitute count. So first substitution: 11*11. Second substitution: 11*10. Third substitution: 11*9. Multiply them together: (11*11)*(11*10)*(11*9) = 11^3 * 11 * 10 * 9? Wait, no. Wait, 11*11 is 11^2, then times 11*10 is 11^3 * 10, then times 11*9 is 11^4 * 9 * 10. Which is 11^4 * 90. Alternatively, 11^3 * P(11, 3) = 11^3 * 11*10*9 = 11^4 * 10*9. Which is same as above. So yes, the formula 11^k * P(11, k) gives the same result as multiplying each substitution step. Therefore, the formula is correct.\n\nBut then, for k substitutions, the number is 11^k multiplied by P(11, k). Therefore, total number of substitution sequences with up to 3 substitutions is the sum for k=0 to 3 of 11^k * P(11, k).\n\nTherefore, total n = 1 (for k=0) + 11^1 * P(11,1) + 11^2 * P(11,2) + 11^3 * P(11,3).\n\nSo let me compute each term.\n\nFirst, k=0: 1.\n\nk=1: 11^1 * P(11,1) = 11 * 11 = 121.\n\nk=2: 11^2 * P(11, 2) = 121 * (11 * 10) = 121 * 110. Let me compute 121*110. Well, 121*100=12,100; 121*10=1,210; total is 12,100 + 1,210 = 13,310.\n\nk=3: 11^3 * P(11, 3). Let's compute 11^3 first. 11^3 is 1331. Then P(11, 3) is 11 * 10 * 9 = 990. Therefore, 1331 * 990. Let me compute that.\n\nFirst, compute 1331 * 1000 = 1,331,000. Then subtract 1331 * 10 = 13,310. Therefore, 1,331,000 - 13,310 = 1,317,690. Wait, but P(11,3) is 990, which is 1000 - 10. Therefore, 1331*(1000 - 10) = 1,331,000 - 13,310 = 1,317,690. Therefore, k=3 term is 1,317,690.\n\nTherefore, total n is:\n\n1 + 121 + 13,310 + 1,317,690.\n\nLet me add them up step by step.\n\nStart with 1 + 121 = 122.\n\nThen 122 + 13,310 = 13,432.\n\nThen 13,432 + 1,317,690 = Let's see:\n\n1,317,690 + 13,432. Let's add 1,317,690 + 10,000 = 1,327,690. Then +3,432 = 1,331,122.\n\nTherefore, total n is 1,331,122.\n\nWait, let me check that again:\n\nFirst term: 1\n\nSecond term: +121 → total 122\n\nThird term: +13,310 → 122 + 13,310 = 13,432\n\nFourth term: +1,317,690 → 13,432 + 1,317,690. Let me write it:\n\n1,317,690\n\n+     13,432\n\n= ?\n\nAdding 1,317,690 + 13,432:\n\nStart from the right:\n\n0 + 2 = 2\n\n9 + 3 = 12, carryover 1\n\n6 + 4 = 10 + 1 = 11, carryover 1\n\n7 + 3 = 10 + 1 = 11, carryover 1\n\n1 + 1 = 2 + 1 = 3, carryover 0\n\nComma separated:\n\nSo 1,317,690 + 13,432 = 1,331,122. Yes.\n\nTherefore, total n is 1,331,122.\n\nBut let me verify once again if my reasoning is correct. Because 1,331,122 seems like a big number, but given that substitutions can be multiple and ordered, maybe it's okay.\n\nBut let me think again about the formula. For each substitution, we have two independent choices: who to take out (11 choices each time) and who to put in (11, 10, 9...). Since substitutions are ordered, the total number is the product over each substitution of (11 * available substitutes). Therefore, for k substitutions, it's 11^k multiplied by 11 * 10 * ... * (11 - k + 1). Which is exactly 11^k * P(11, k). Therefore, the formula is correct.\n\nTherefore, adding up all possibilities for k=0,1,2,3 gives 1 + 121 + 13,310 + 1,317,690 = 1,331,122. Then we need to compute this modulo 1000.\n\nSo, to find 1,331,122 mod 1000, we can look at the last three digits of the number. Let's see:\n\nThe number is 1,331,122. Breaking it down:\n\n1,331,122 divided by 1000 is 1331 with a remainder of 122. Because 1331 * 1000 = 1,331,000. Then 1,331,122 - 1,331,000 = 122. Therefore, 1,331,122 mod 1000 is 122.\n\nWait, so the answer is 122? But let me check again. Wait, 1,331,122 divided by 1000: the last three digits are 122, yes. So remainder is 122. Therefore, the answer is 122. But let me verify my total n again because 122 seems low. Let me check my calculations again.\n\nWait, let me recompute the total n:\n\nk=0: 1\n\nk=1: 11*11 = 121. Total so far: 1 + 121 = 122.\n\nk=2: 11^2 * 11*10 = 121 * 110. 121*100=12,100; 121*10=1,210. Total 12,100 + 1,210 = 13,310. Total so far: 122 + 13,310 = 13,432.\n\nk=3: 11^3 * 11*10*9. Wait, 11^3 is 1331, and 11*10*9 is 990. So 1331 * 990. Let me recalculate that:\n\nFirst, 1331 * 990.\n\nNote that 990 = 1000 - 10. Therefore, 1331 * 990 = 1331*(1000 - 10) = 1331*1000 - 1331*10 = 1,331,000 - 13,310 = 1,317,690. Correct. Then adding to previous total of 13,432: 1,317,690 + 13,432 = 1,331,122. Correct. Then mod 1000 is 122. So 122 is the remainder. Therefore, the answer is 122. But let me check once more if my reasoning is correct, because 122 seems like the same as the k=1 case. But maybe that's a coincidence.\n\nWait, but let me think of another way. Let me check if there's an alternative approach.\n\nAlternative approach: think of substitutions as sequences where each substitution is an ordered pair (player_out, substitute_in). However, substitutes_in must be unique (no repeat substitutes), and player_out can be any of the 11 on the field at that time. However, since players can be substituted multiple times (as long as they haven't been taken out), but once a player is taken out, they can't come back. However, the player_out choices depend on the current team on the field.\n\nBut since the coach can make up to 3 substitutions, maybe we can model this as permutations with certain constraints.\n\nBut perhaps my original approach is correct.\n\nAlternatively, think recursively. Let me think for the number of substitution sequences.\n\nLet me denote that after m substitutions, there are m substitutes on the field and 11 - m original players. However, substitutions can be made in any order, but each substitution involves removing someone (original or substitute) and replacing with a new substitute.\n\nBut this seems complex. However, my original calculation considered that at each substitution, there are always 11 players on the field, hence 11 choices for who to take out, and the number of substitutes available is 11 - (number of previous substitutions). Therefore, for each substitution, the number of choices is 11 * (11 - number of previous substitutions). Therefore, for sequences of substitutions, the total number is the product for each substitution step.\n\nTherefore, for 0 substitutions: 1.\n\nFor 1 substitution: 11*11.\n\nFor 2 substitutions: 11*11 * 11*10. Wait, no, that would be 11*11 (first substitution) multiplied by 11*10 (second substitution). But since substitutions are ordered, that is correct.\n\nBut then, the total is as calculated. Therefore, the total number is indeed 1 + 121 + 13,310 + 1,317,690 = 1,331,122. Therefore, mod 1000 is 122.\n\nBut let me check with smaller numbers to see if my formula is correct.\n\nSuppose we have 2 substitutions allowed, with 2 starting players and 2 substitutes. Let's compute manually and check against formula.\n\nTotal ways:\n\nk=0: 1.\n\nk=1: 2 players to remove, 2 substitutes to add: 2*2=4.\n\nk=2: first substitution: 2*2. Second substitution: For the second substitution, there are still 2 players on the field (one original, one substitute). So 2 choices to remove. Substitutes remaining: 1. So 2*1. Therefore total for k=2: 2*2 * 2*1 = 8. Total n = 1 + 4 + 8 = 13.\n\nUsing formula: n = 1 + 11^1*P(11,1) + ... but in this case, with N=2 players and substitutes. Wait, if we adjust the formula for N=2, then:\n\nFor k substitutions, it's N^k * P(N, k). For N=2:\n\nk=0: 1.\n\nk=1: 2^1 * P(2,1) = 2*2=4. Correct.\n\nk=2: 2^2 * P(2,2) = 4 * 2 = 8. Correct. Total n=1+4+8=13. Which matches manual calculation. So formula works here.\n\nAnother example: N=1 (1 starting player, 1 substitute). Max substitutions, say 1.\n\nTotal ways:\n\nk=0: 1.\n\nk=1: 1*1=1.\n\nTotal n=2. Which is correct: either no substitution or substitute once (only possible way).\n\nFormula: 1 + 1^1 * P(1,1) = 1 + 1*1=2. Correct.\n\nTherefore, formula seems correct. Hence, going back to original problem, answer is 1,331,122 mod 1000 = 122.\n\nBut wait, the problem says \"the coach may make as many as 3 substitutions\", so up to 3. Therefore, our calculation includes 0,1,2,3 substitutions. So total n=1,331,122, mod 1000 is 122.\n\nBut let me check once more if I didn't make an arithmetic error in adding up the numbers.\n\nOriginal numbers:\n\nk=0: 1\n\nk=1: 121 → total 122\n\nk=2: 13,310 → total 122 + 13,310 = 13,432\n\nk=3: 1,317,690 → total 13,432 + 1,317,690 = 1,331,122. Correct.\n\nYes, and 1,331,122 divided by 1000 is 1331 * 1000 + 122, so remainder 122. Therefore, answer is 122.\n\nBut wait, hold on, let me check with another approach. Maybe using generating functions or something else?\n\nAlternatively, think about each substitution as an operation. Since substitutions can be 0,1,2,3, and each substitution is dependent on previous ones.\n\nBut I think my approach is correct. Therefore, I think the answer is 122. However, to be thorough, let me check if there is a different interpretation of the problem.\n\nThe problem says: \"the coach may make as many as 3 substitutions, where any one of the 11 players in the game is replaced by one of the substitutes. No player removed from the game may reenter the game, although a substitute entering the game may be replaced later. No two substitutions can happen at the same time. The players involved and the order of the substitutions matter.\"\n\nSo, another way: think of each substitution as an ordered action. Each substitution is defined by:\n\n- Which player is substituted out (must be someone currently on the field).\n\n- Which substitute is substituted in (must be someone not yet substituted in).\n\nTherefore, for the first substitution, as before, 11 * 11.\n\nFor the second substitution, as before, 11 * 10.\n\nFor the third substitution, 11 * 9.\n\nTherefore, the number of sequences of substitutions of length k is the product from i=0 to i=k-1 of (11*(11 - i)).\n\nWhich is the same as 11^k multiplied by P(11, k). Wait, no:\n\nWait, for k substitutions, it's product_{i=0}^{k-1} [11*(11 - i)] = 11^k * product_{i=0}^{k-1} (11 - i) = 11^k * P(11, k). Because product_{i=0}^{k-1} (11 - i) = 11 * 10 * 9 * ... * (11 - k + 1) = P(11, k). Therefore, yes, same formula.\n\nTherefore, the total number is sum_{k=0}^3 [11^k * P(11, k)].\n\nTherefore, calculations are correct.\n\nTherefore, answer is 122. However, I have a doubt because 122 seems low for a modulus 1000, but maybe it is. Let me check if I miscalculated 1,331,122 mod 1000.\n\nYes, 1,331,122 divided by 1000 is 1331 with remainder 122. Because 1331 * 1000 = 1,331,000. Then 1,331,122 - 1,331,000 = 122. Therefore, remainder is 122. Therefore, answer is 122.\n\nBut let me check if I made a mistake in computing 11^3 * P(11, 3). Let me recompute 1331 * 990:\n\nFirst, 1331 * 990. Let's break down 990 as 900 + 90.\n\nCompute 1331 * 900:\n\nWell, 1331 * 9 * 100.\n\n1331 * 9: Let's compute 1331 * 10 = 13,310 minus 1331 = 13,310 - 1,331 = 11,979. Then times 100 is 1,197,900.\n\nThen 1331 * 90:\n\nSame as 1331 * 9 * 10. We already have 1331 * 9 = 11,979. Multiply by 10: 119,790.\n\nTherefore, total is 1,197,900 + 119,790 = 1,317,690. Which matches previous calculation. Therefore, correct.\n\nTherefore, adding up all terms is correct. Therefore, the answer is 122.\n\nBut to be 100% sure, let me check if there is an OEIS or formula that I can reference, but since I can't access external resources, I need to rely on my own calculations.\n\nAnother sanity check: total number of substitution sequences for up to 3 substitutions is 1 + 121 + 13,310 + 1,317,690 = 1,331,122. Let me check if this number is reasonable.\n\nTotal possible substitution sequences if there were no limit on substitutes: For each substitution, 11 players out and 11 substitutes in, so for k substitutions, (11*11)^k. But since substitutes can't be reused, the actual number is less. For k=3, 1,317,690 versus (11*11)^3 = 1331^3 ≈ 2.35e9, which is way bigger. So our number is much smaller, which makes sense. So 1.3 million seems reasonable for up to 3 substitutions.\n\nTherefore, I think my answer is correct. Therefore, the remainder when n is divided by 1000 is 122.\n\n**Final Answer**\n\\boxed{122}\n</think>"}